# Proposal: The Audiobook Director AI

## Executive Summary

This document proposes the creation of a new high-level agent, the **Audiobook Director**, to orchestrate the existing suite of specialist AI agents. While the current pipeline has powerful tactical agents for tasks like pacing, pronunciation, and voice matching, it lacks a strategic, creative authority to ensure artistic consistency across an entire book.

The Audiobook Director will act as this authority. It will perform a "pre-production" analysis of the source text to create a **"Production Bible"**. This central document will guide all downstream agents, ensuring that character voices, narrative pacing, and specific pronunciations remain consistent from the first chapter to the last. This will elevate the final product from a technically correct narration to an artistically coherent and immersive audiobook.

## Current State: A Talented but Uncoordinated Crew

The current pipeline is equipped with an impressive array of specialist agents, including:

-   `LlamaVoiceMatcher`: Intelligently selects voices based on genre and content.
-   `LlamaPacingAgent`: Analyzes text to provide pacing hints (e.g., "fast", "slow").
-   `LlamaPronunciationAssistant`: Identifies difficult words and generates phonetic pronunciations.
-   `LlamaChunker` & `LlamaChunkReviewer`: Handle the logical segmentation and quality control of the text.

Each agent performs its task effectively within its own phase. However, they operate in isolation, without a shared understanding of the book's overall creative direction. This can lead to inconsistencies in long-form content, especially in complex works of fiction or non-fiction with specific terminologies.

## The "Audiobook Director" Concept

The Audiobook Director will be a new, high-level agent that runs before any processing begins (a new "Phase 0"). Its sole responsibility is to analyze the entire source text and create a unified creative plan, which it will store in a new file called `production_bible.json`.

This "Production Bible" will then serve as the single source of truth for all creative decisions made by the downstream specialist agents.

## The "Production Bible"

The `production_bible.json` file will be the central artifact created by the Director. It will contain a comprehensive plan for the audiobook's narration.

```json
{
  "narrative_profile": {
    "primary_tone": "suspenseful",
    "secondary_tone": "introspective",
    "pace": "medium-fast",
    "style_notes": "Build tension in dialogue scenes, use a calmer voice for descriptive passages."
  },
  "character_map": {
    "Gandalf": {
      "assigned_voice": "am_adam",
      "voice_description": "Deep, wise, and slightly gravelly male voice. Should sound patient and powerful.",
      "dialogue_example": "A wizard is never late, Frodo Baggins. Nor is he early. He arrives precisely when he means to."
    },
    "Pippin": {
      "assigned_voice": "en_GB-scotland-male",
      "voice_description": "Young, energetic male voice with a slight Scottish accent. Should sound curious and sometimes naive.",
      "dialogue_example": "What about second breakfast?"
    }
  },
  "pacing_guide": {
    "chapter_1": "slow_intro",
    "chapter_5_scene_3": "fast_action",
    "chapter_10_ending": "dramatic_pause"
  },
  "pronunciation_lexicon": {
    "Siobhan": {
      "ipa": "ʃəˈvɔːn",
      "arpabet": "SH AH V AO N",
      "say_as": "shuh-VAWN"
    },
    "Ancalagon": {
      "ipa": "/aŋˈkalaɡon/",
      "arpabet": "AE NG K AA L AA G AO N",
      "say_as": "an-CAL-a-gon"
    }
  }
}
```

### Components of the Production Bible:

1.  **Narrative Profile:** Defines the overall tone and style of the narration.
2.  **Character Map:** Identifies all speaking characters and assigns them a specific TTS voice and vocal description. This is crucial for consistency. The Director would use the `LlamaVoiceMatcher`'s capabilities to make informed initial assignments.
3.  **Pacing Guide:** Provides a high-level map of the book's desired pacing, which can be applied at a chapter or even scene level.
4.  **Pronunciation Lexicon:** A centralized dictionary of words that require specific pronunciation, generated by the `LlamaPronunciationAssistant`.

## New Workflow with the Director

1.  **Phase 0: Pre-Production**
    -   The Audiobook Director agent is invoked.
    -   It reads the entire input text.
    -   It uses its LLM to identify characters, analyze narrative structure, and find difficult words.
    -   It orchestrates the `LlamaVoiceMatcher` and `LlamaPronunciationAssistant` to populate the `character_map` and `pronunciation_lexicon`.
    -   It generates the complete `production_bible.json` in the book's output directory.

2.  **Phase 3-5: Guided Production**
    -   The existing agents are modified to first check for a `production_bible.json`.
    -   **`LlamaChunker` / `phase3-chunking`**: Can use the `Pacing Guide` to influence chunking strategy (e.g., shorter chunks for faster-paced sections).
    -   **Voice Selection**: Instead of relying on just genre, the voice selection logic will use the `character_map` from the bible to assign voices, especially for dialogue.
    -   **`LlamaPacingAgent`**: Will use the `Pacing Guide` as a stronger signal for its hints, ensuring scene-level pacing matches the Director's intent.
    -   **`LlamaPreValidator` / TTS Engine**: Before synthesis, text will be checked against the `pronunciation_lexicon`. Any matches will be replaced with the appropriate phonetic spelling or markup (e.g., SSML `<phoneme>`).

## Benefits of This Approach

1.  **Creative Consistency:** Guarantees that a character sounds the same in Chapter 20 as they did in Chapter 1. The narrative tone will be coherent throughout.
2.  **Higher Quality Output:** Proactive handling of pronunciation and pacing leads to a more polished and professional-sounding audiobook.
3.  **Improved Handling of Complex Books:** Novels with large casts of characters (e.g., *Game of Thrones*) or complex terminology (e.g., *Dune*, technical manuals) become much more manageable.
4.  **Foundation for Future Enhancements:** This framework can be extended to manage accents, emotional expression (if the TTS engine supports it), and other advanced narrative features.
5.  **Smarter Collaboration:** It makes the specialist agents work together as a team, led by a unified creative vision.

## Proposed Implementation Steps

1.  **Create the `AudiobookDirector` Agent:** Develop the new agent in `agents/audiobook_director.py`. This agent will contain the logic for reading the text and generating the `production_bible.json`.
2.  **Integrate Pre-Production Step:** Add a new "Phase 0" to the orchestrator that runs the `AudiobookDirector` agent.
3.  **Modify Downstream Agents:**
    -   Update the voice selection logic to prioritize the `character_map`.
    -   Update the `LlamaPacingAgent` to take cues from the `pacing_guide`.
    -   Update the pre-synthesis step in `phase4_tts` to incorporate the `pronunciation_lexicon`. This might involve creating a new function that applies the lexicon to the text before it's sent to the TTS engine.
4.  **Update Documentation:** Add the `AUDIOBOOK_DIRECTOR_PROPOSAL.md` to the main documentation and update the roadmap to reflect this new, strategic layer.
