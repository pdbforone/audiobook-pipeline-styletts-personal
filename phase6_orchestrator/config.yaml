# Phase 6 Orchestrator Configuration
pipeline_json: "../pipeline.json"
phases_to_run: [1, 2, 3, 4, 5]
resume_enabled: true
log_level: "INFO"
log_file: "orchestrator.log"

# Per-phase timeouts (in seconds)
# Set phase_timeout to override all phases with a single value
# phase_timeout: 600  # Uncomment to set global timeout
phase_timeouts:
  phase1: 18000       # 5 hours - validation
  phase2: 18000       # 5 hours - extraction
  phase3: 3600        # 1 hour - chunking (LlamaChunker can be slow)
  phase4: 259200      # 3 days - TTS synthesis (280-page book ~2 days on CPU)
  phase5: 7200        # 2 hours - enhancement
  phase5_5: 14400     # 4 hours - subtitles
  poetry_install: 300 # 5 minutes - dependency install

# Runtime switches
pipeline_mode: "personal"
tts_engine: "xtts"       # xtts | kokoro
tts_engines:
  primary: "xtts"
  secondary: "kokoro"
per_chunk_fallback: true
phase4_reuse_enabled: true
min_mos_for_reuse: null
max_tts_workers: 1
strict_chunk_integrity: true
prefer_shell_tts_execution: false
global_time_budget_sec: null
subtitles:
  enable_backup_align: true
  max_drift_sec: 2.0
  min_coverage_ratio: 0.95

# Benchmark harness (Phase E - opt-in)
benchmark:
  enable: false
  version: "phaseE"
  auto_run: false
  test_texts:
    - "Short generic English test passage used for timing and quality checks."
    - "Another test passage for benchmarking the audiobook pipeline end-to-end."
    - "A slightly longer passage to approximate real audiobook phrasing and pacing."

# Autonomy/Self-Repair (opt-in, safety-gated)
autonomy:
  enable: true
  version: "phaseG"
  global:
    enable_full_autonomy: false
    require_safety_envelope: true
    require_passing_self_eval: true
    require_schema_valid: true
    require_no_high_drift: true
  supervised_mode: false
  enable_self_repair: false
  use_reasoner: false
  planner_mode: "recommend_only"  # disabled | recommend_only | enforce (future)
  memory_enabled: false
  memory_summarization: "periodic"  # periodic | off
  mode: "autonomous"         # disabled | recommend_only | supervised | autonomous (future)
  supervised_threshold: 0.85
  policy_kernel_debug: false
  policy_kernel_enabled: false
  enable_policy_engine: true
  enable_engine_retry: true
  enable_experiments: true
  enable_memory_feedback: false
  enable_stability_profiles: false
  enable_confidence_calibration: true
  enable_self_evaluation: true
  enable_planner_feedback: true
  enable_self_review: true
  enable_rewards: true
  enable_profile_learning: false
  enable_genre_learning: false
  enable_profile_fusion: false
  enable_long_horizon: false
  enable_long_horizon_learning: true
  enable_forecasting: true
  enable_drift_monitoring: true
  enable_long_horizon_profiles: false
  enable_trend_modeling: false
  enable_budget: true
  enable_stability_bounds: true
  enable_safety_envelope: true
  enable_safety_escalation: true
  stability_bounds:
    enable: true
    max_chunk_delta_pct: 10
    max_engine_switches: 1
    max_rewrite_delta_pct: 10
  escalation:
    enable: true
    drift_threshold: 3
    lockout_runs: 5
  profiles:
    enable: false
    exploration_rate: 0.05
    export_on_shutdown: false
    allow_reset_via_flag: false
    reset_now: false
  readiness_checks:
    enable: true
    min_reward_avg: 0.0
    require_recent_success: true
    require_no_anomalies: true
    require_stable_benchmarks: true
    require_positive_reward: false
  enable_policy_limits: false
  budget:
    max_overrides_per_run: 2
    max_change_magnitude: "small"
    allowed_fields:
      - "chunk_size"
      - "engine_preference"
      - "rewrite_policy"
  self_eval:
    enable: true
    enable_planner_feedback: true
    history_window_runs: 5

self_repair:
  enable: false
  version: "phaseD"
  enable_text_rewrite: false
  rewrite_confidence_threshold: 0.7
  enable_repair_loop: false
  enable_log_parser: false
  repair_confidence_threshold: 0.85
  enable_engine_retry: false
  retry_confidence_threshold: 0.85

# LLM/Ollama configuration for AI-powered features
llm:
  enable: true
  model: "llama3.1:8b-instruct-q4_K_M"  # Default model for all LLM features
  auto_start_server: true               # Start Ollama server if not running
  auto_pull_model: true                 # Pull model if not available

reasoning:
  enable: false
  version: "phaseH"
  enable_evaluator: false
  enable_diagnostics: false

experiments:
  enable: false
  limit_per_run: 1
  allowed:
    - "chunk_size"
    - "engine_preference"
    - "rewrite_policy"
  dry_run: true

genre:
  enable_classifier: false
  use_llama: false

rewriter:
  enable_policies: false
  default_policy: "minimal_fix"

adaptive_chunking:
  enable: false

patches:
  enable_simulation: false

dashboard:
  enable_data_api: false
# Phase A-C placeholders (opt-in, disabled)
phaseA:
  enable: false
  version: "phaseA"
phaseB:
  enable: false
  version: "phaseB"
phaseC:
  enable: false
  version: "phaseC"
phaseAA:
  enable: false
  version: "phaseAA"
# Research (Phase P - opt-in)
research:
  enable: false
  version: "phaseP"
  collect_phase_metrics: false
  collect_failure_patterns: false
  collect_engine_stats: false
  collect_chunk_stats: false
  collect_memory_signals: false
  collect_policy_signals: false
  enable_quality_gate: false
  enable_feedback_loop: false
  enable_safety_verification: false
  enable_lifecycle: false
phaseR:
  enable: false
  version: "phaseR"
  lookback_runs: 20
  include_benchmarks: true
  include_self_eval: true
  include_error_registry: true
  include_policy_logs: true
phaseS:
  enable: false
  version: "phaseS"
  include_self_eval: true
  include_phaseR: true
  lookback: 10
consistency:
  enable: false
  version: "phaseT"
  max_history_runs: 50
phaseT:
  enable: false
  version: "phaseT"
  include_self_eval: true
  include_phaseR: true
  include_benchmarks: true
phaseU:
  enable: false
  version: "phaseU"
  include_self_eval: true
  include_phaseR: true
  include_phaseS: true
  include_audit: true
phaseV:
  enable: false
  version: "phaseV"
  dry_run: true
  lookback_runs: 20
  include_policy_logs: true
  include_error_registry: true
  include_memory: true
  include_stability_profiles: true
  include_self_eval: true
  include_research: true
  targets:
    - pipeline_state
    - policy_logs
    - stability_profiles
    - memory
    - self_eval
    - research
phaseW:
  enable: false
  version: "phaseW"
  include_warnings: true
  include_recommendations: true
phaseX:
  enable: false
  version: "phaseX"
  include_Q: true
  include_R: true
  include_S: true
  max_depth: 3
phaseY:
  enable: false
  version: "phaseY"
phaseZ:
  enable: false
  version: "phaseZ"
phaseAC:
  enable: false
  include_all_phases: true
  annotate_conflicts: true
phaseAD:
  enable: false
  include_hidden: false
  ui_safe_only: true
  include_phase_summaries: true
  include_dependency_scan: true
  include_invariants: true
phaseQ_self_eval:
  enable: false
  version: "phaseQ"
  enable_meta_evaluator: false
  enable_reflection_writer: false
  output_dir: ".pipeline/self_eval"
phaseQ_self_evaluation:
  enable: false
  version: "phaseQ"
  metrics:
    - "run_health"
    - "stability"
    - "repair_effectiveness"
    - "autonomy_boundedness"
  output_dir: ".pipeline/self_evaluation"
# Phase J-K-L-M-N-O (read-only, analytics)
phaseJ:
  enable: false
  version: "phaseJ"
phaseK:
  enable: false
  version: "phaseK"
phaseL:
  enable: false
  version: "phaseL"
phaseM:
  enable: false
  version: "phaseM"
phaseN:
  enable: false
  version: "phaseN"
phaseO:
  enable: false
  version: "phaseO"
# Introspection (Phase I - opt-in)
introspection:
  enable: true
  version: "phaseI"
  enable_clustering: false
  enable_narratives: false
  enable_self_critique: false
  enable_summary: false
  enable_reasoning_trace: false
  enable_feature_attribution: false
# Policy Engine (learning/telemetry)
policy_engine:
  logging: true               # Record telemetry to .pipeline/policy_logs/
  learning_mode: "enforce"    # observe | enforce | tune
  # observe: Log recommendations but don't apply
  # enforce: Auto-apply recommendations on retry (engine switching, voice variants)
  # tune: Same as enforce + allow self-driving parameter adjustments

metadata:
  enable: false
  version: "phaseF"
  enable_llama_metadata: false
# Capabilities switchboard (safe, read-only layers)
capabilities:
  enable_safe_modes: true
  enable_phaseI: true
  enable_phaseJ: true
  enable_phaseK_safe: true
  enable_phaseP: true
  enable_phaseQ: true
  enable_phaseR: true
  enable_phaseS: true
  enable_phaseT: true
  enable_phaseU: true
  enable_phaseV: true
  enable_phaseW: true
  enable_phaseX: true
  enable_phaseY: true
  enable_phaseZ: true
phaseAE:
  enable: false
  version: "phaseAE"
phaseAF:
  enable: false
  version: "phaseAF"
phaseAB:
  enable: false

ui:
  show_autonomy_features: true
  allow_toggle: true
